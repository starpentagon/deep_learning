# Deep Neural Network modelの動作検証の概要
* 以下の主要3タスクの有名モデルの動作方法を検証
  1. classification: ResNet50
  2. detection: SSD
  3. segmentation: Mask R-CNN
* 手元の画像で主要タスクを動かした結果を共有
* おまけ: Jupyter notebookからリモートで分析を行う方法の紹介

# 動作させる上でのハマりポイント
* GPUの認識
  * GPUのCompute Compatibility, CUDA, cuDNNのバージョンを揃える必要あり
  * AWSのDeep Learning AMIを使うと設定済みなので楽
  * そもそも学習をしないのであればCPUモードで確認するのが無難
* python, pythonモジュール, FW(TensorFlow, Keras)の相性がめちゃくちゃシビア
  * Python環境の切り分けはマスト
  * 各種モジュール群を最新版にしないと動かないケースと最新版固有のバグがあり悩ましい
  * メジャーな実装を使うのが情報が多く解決しやすい
  * 個人が公開しているコードは雑な実装が多くかなりバグが多い
  * Linuxでソースからビルドしていた時代を彷彿とさせる課題解決力が必要
* 学習済みモデルが提供されているか
  * 提供されていなければ自前で学習する必要がある
  * データセットのダウンロードやデータセットをハンドリングするツールをインストールする必要がありハードルが一段上がる
  * CPUだと学習に時間がかかりすぎる（segmentationでFCNを使おうとしたがCPUだと学習に25日かかる計算になり断念）ためGPUを使う必要がありハードルが上がる
  * 学習済みモデルが提供されていてもモデルのインターフェースが変わっているケースがあり(detectionのSSDでハマった)、個別にトラブルシュートが必要。ここでもメジャーなアルゴリズム、実装であれば情報が入手しやすい

## Classification: ResNet
* Kerasで学習済みモデルを含めて提供されており非常に容易に利用可能
* Tutorialが丁寧
* 独自データでの再学習も簡単

## Detection: SSD
* メジャー実装はKeras1版でKeras2には非対応
* Keras1環境を別途作るかKeras2版を探す必要あり
  * Keras2版を探した
* Keras 2.1.3 -> Keras 2.1.4でモデルのインターフェースが変わったらしく公開されている学習済みモデルはそのままでは使えない。
  * Keras 2.1.4用に修正したコードを見つけて対応

## Segmentation: FCN
* 最初はFCNを使おうとした
* 公開されているコードはPython2前提でハマる
* 事前学習モデルが公開されておらずMS COCOというデータセットで自前で学習が必要
  * MS COCOを扱うツールのインストールでビルドエラー多発
  * 実はGitレポジトリが変更になっていて古いレポジトリを見ていた
  * さらに内部で使っているkeras-contrib関連でエラー多発
  * keras-contribの最新版をpipで入れると無事動いた
  * 学習しようとしたらGPUを使ってくれない
  * CPUだと25日かかる計算になり断念

## Segmentation: Mask R-CNN
* Git上で詳細な説明がのっている
* git clone -> 「notebookで実行」で一発で動いた！
* と思ったが、画像により結構な頻度(70%くらいで)kernelが死ぬ
  * Math kernel libraryが悪さをしているという情報もあり使わないようにしてみたが解決せず

